{% extends "users/base.html" %}
{% block users_content %}
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 style="margin: 0;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
            <p class="muted" style="margin: 8px 0 0 0;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
        </div>
        <a class="btn primary" href="/users/create" {% if plan_missing %}style="opacity: 0.5; pointer-events: none;"{% endif %}>
            <span>‚ûï</span>
            <span>–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
        </a>
    </div>
</div>

{% if plan_missing %}
<div class="alert error">
    <span>‚ö†Ô∏è</span>
    <span>–ù–µ—Ç —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–ª–∞–Ω, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</span>
</div>
{% endif %}

{% if users %}
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Email</th>
            <th>–ò–º—è</th>
            <th>–†–æ–ª—å</th>
            <th>–¢–∞—Ä–∏—Ñ</th>
            <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
            <th>–°–æ–∑–¥–∞–Ω</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.name or "‚Äî" }}</td>
            <td><span class="badge {{ user.role }}">{{ user.role }}</span></td>
            <td>
                <span style="display: inline-flex; align-items: center; gap: 6px;">
                    <span>üíé</span>
                    <strong>{{ user.plan.name if user.plan else "‚Äî" }}</strong>
                </span>
            </td>
            <td>
                {% if user.is_active %}
                <span style="color: var(--success); font-weight: 600;">‚úì –ê–∫—Ç–∏–≤–µ–Ω</span>
                {% else %}
                <span style="color: var(--text-muted);">‚úó –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                {% endif %}
            </td>
            <td>{{ user.created_at.strftime("%Y-%m-%d %H:%M") if user.created_at else "‚Äî" }}</td>
            <td class="actions">
                <a href="/users/{{ user.id }}">–î–µ—Ç–∞–ª–∏</a>
                <a href="/users/{{ user.id }}/edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                {% if user.is_active %}
                <form method="post" action="/users/{{ user.id }}/deactivate" style="display: inline;">
                    <button type="submit" style="background: none; border: none; color: var(--error); padding: 0; cursor: pointer; text-decoration: underline; font-size: inherit; font-family: inherit;">–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
                {% else %}
                <form method="post" action="/users/{{ user.id }}/activate" style="display: inline;">
                    <button type="submit" style="background: none; border: none; color: var(--success); padding: 0; cursor: pointer; text-decoration: underline; font-size: inherit; font-family: inherit;">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
{% endif %}
{% endblock %}